# IAM Service Configuration

app:
  name: iam-service
  version: "1.0.0"
  env: development  # development, staging, production

server:
  grpc_port: 50052
  http_port: 8081
  read_timeout: 30s
  write_timeout: 30s

database:
  host: localhost
  port: 5435
  user: iam
  password: iam123
  name: iam_db
  ssl_mode: disable
  max_open_conns: 25
  max_idle_conns: 5
  conn_max_lifetime: 5m

redis:
  host: localhost
  port: 6379  # Shared Redis instance (use docker-compose.yaml at backend root)
  password: ""
  db: 1  # DB 1 for IAM (sessions, blacklist, OTP). Finance uses DB 0 for cache.
  session_ttl: 168h  # Session expiry (7 days)
  token_blacklist_ttl: 24h  # Revoked token blacklist

jwt:
  access_token_secret: "dev-access-secret-change-in-production"
  refresh_token_secret: "dev-refresh-secret-change-in-production"
  access_token_ttl: 15m
  refresh_token_ttl: 168h  # 7 days
  issuer: "goapps-iam"

cors:
  allowed_origins:
    - "http://localhost:3000"
  max_age: 300

email:
  smtp_host: localhost
  smtp_port: 1025
  smtp_user: ""
  smtp_password: ""
  from_address: "noreply@goapps.local"
  from_name: "GoApps IAM"
  use_tls: false
  skip_verify: true

totp:
  issuer: "GoApps"
  digits: 6
  period: 30  # seconds
  algorithm: SHA1

security:
  password_min_length: 8
  password_require_uppercase: true
  password_require_lowercase: true
  password_require_number: true
  max_login_attempts: 5
  lockout_duration: 15m
  otp_expiry: 5m
  reset_token_expiry: 10m
  single_device_login: true  # Force logout previous session on new login

tracing:
  enabled: true
  endpoint: localhost:4317
  insecure: true

rate_limit:
  requests_per_second: 100
  burst_size: 200
  login_requests_per_minute: 10  # Stricter for auth endpoints
  login_burst_size: 5

storage:
  endpoint: localhost:9000
  access_key: minioadmin
  secret_key: minioadmin
  bucket: goapps-staging           # Shared bucket: goapps-staging (dev/staging), goapps-production (prod)
  base_path: iam                   # Service prefix inside bucket â†’ objects at: iam/avatars/{user}/{file}
  use_ssl: false                   # true in staging/production (MinIO TLS)
  insecure_skip_verify: true       # Skip TLS verification for self-signed certs
  region: us-east-1
  public_url: ""                   # Override for external access URL, e.g., https://staging-goapps.mutugading.com/storage

logging:
  level: debug  # debug, info, warn, error
  format: console  # console, json
